<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="cuba-form-behavior.html">

<!--
`cuba-form-service`
-->

<dom-module id="cuba-form-service">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <form id="form">
      <content></content>
    </form>
  </template>

  <script>
    Polymer({

      is: 'cuba-form-service',

      behaviors: [CubaFormBehavior],

      properties: {
        serviceName: String,
        method: String,
        params: {
          type: Object
        },
        result: {
          type: Object,
          notify: true,
          readOnly: true
        }
      },

      ready: function() {
        this.$.form.addEventListener('submit', function(event) {
          event.preventDefault();
          this.submit();
          return false;
        }.bind(this));
      },

      submit: function() {
        this._clearErrors();
        return cubaApp.invokeService(this.serviceName, this.method, this.params).then(function(resp) {
          this.result = resp;
          this.fire('cuba-form-response');
        }.bind(this), function(errResp) {
          this._handleError(errResp);
          this.fire('cuba-form-error');
        }.bind(this));
      }
    });
  </script>
</dom-module>
