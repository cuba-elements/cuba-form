<script>

  /**
   * Exposes bean validation errors.
   *
   * @polymerBehavior CubaFormBehavior
   */

  CubaFormBehavior = {

    properties: {
      /**
       * Map of errors returned by REST API (bean validation) {fieldPath: concatenatedErrorMessage, ...}.
       */
      serverErrors: {
        type: Object,
        notify: true,
        readonly: true,
        value: function() {
          return {};
        }
      },
      /**
       * Raw list of errors returned by REST API (bean validation).
       */
      rawServerErrors: {
        type: Array,
        notify: true,
        readonly: true,
        value: function() {
          return [];
        }
      }
    },

    _clearErrors: function() {
      this.set("serverErrors", {});
      this.set("rawServerErrors", []);
    },

    _handleError: function(resp) {
      let erors = resp.responseJSON;
      if (resp.status == 400 && erors && Array.isArray(erors)) {
        this.set("rawServerErrors", erors);
        for (let i = 0; i < erors.length; i++) {
          let path = erors[i].path || "$global";
          this._addError(path, erors[i].message)
        }
      }
    },

    _addError: function(path, errorMessage) {
      this.serverErrors[path] ? this.serverErrors[path] += "; " + errorMessage : this.serverErrors[path] = errorMessage;
      this.notifyPath("serverErrors." + path);
    }
  }

</script>